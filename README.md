# Solanaå…¨ç«¯é–‹ç™¼

é€™æ˜¯åŸºæ–¼[é€™ç¯‡](https://dev.to/dabit3/the-complete-guide-to-full-stack-solana-development-with-react-anchor-rust-and-phantom-3291)åšçš„ä¸€äº›æ¿ƒç¸®æ•´ç†ã€‚

## å°ˆæ¡ˆæ¦‚è¿°

é€™å€‹æ‡‰ç”¨æœƒç”¨åˆ°ä»¥ä¸‹çš„å·¥å…·

### [Solana Tool Suite](https://docs.solana.com/cli/install-solana-cli-tools)

é€™æ˜¯Solanaå®˜æ–¹çš„å·¥å…·ï¼Œè£¡é¢æŠŠå¸¸ç”¨çš„æŒ‡ä»¤éƒ½åŒ…è£å¥½äº†ã€‚

### [Anchor Framework](https://project-serum.github.io/anchor/getting-started/introduction.html)

Anchorå°±åƒæ˜¯Hardhat,Truffleé€™é¡çš„å·¥å…·ã€‚ä»–é‚„åœ¨Rustçš„æ›´ä¸Šå±¤æä¾›äº†DSLï¼Œè®“ä½ å¯ä»¥åœ¨ä¸æ˜¯å¾ˆç†Ÿæ‚‰Rustçš„åŒæ™‚ä¹Ÿèƒ½é–‹å§‹é–‹ç™¼ï¼ä½†ä¹Ÿæ˜¯æ»¿å»ºè­°èƒ½åœ¨æœ‰ç©ºä¹‹æ–¼å­¸ç¿’ä¸€ä¸‹Rustï¼Œé€™é‚Šæœ‰ä¸€å€‹[æ»¿å¥½çš„åœ°æ–¹å¯ä»¥å­¸ç¿’](https://doc.rust-lang.org/book/title-page.html)

### [solana/web3.js](https://solana-labs.github.io/solana-web3.js/)

å°±æ˜¯Solanaç‰ˆæœ¬çš„[web3.js](https://web3js.readthedocs.io)ï¼Œå¦å¤–æˆ‘æœ‰ä¸€ç¯‡[solana-web3-demo](https://github.com/yihau/solana-web3-demo)å¯ä»¥æ­é…ä½¿ç”¨ã€‚

### [React](https://reactjs.org/)

ç„¡é ˆå¤šåšä»‹ç´¹ï¼Œå¾ˆç†±é–€çš„å‰ç«¯æ¡†æ¶ã€‚

é€™é‚Šæœƒä¸»è¦å°ˆæ³¨åœ¨é–‹ç™¼è€Œä¸æœƒå°Solanaé€²è¡Œå¤ªæ·±å…¥åœ°è¬›è§£ã€‚ä½†å¦‚æœä½ æƒ³è¦æ›´äº†è§£Solanaçš„è©±ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢å¹¾ç¯‡

- [Solana Docs Introduction](https://docs.solana.com/introduction)
- [ok so what the fuck is the deal with solana anyway](https://2501babe.github.io/posts/solana101.html)
- [Solana Summer](https://www.notboring.co/p/solana-summer)

ä»¥ä¸Šæ˜¯åŸä½œè€…åˆ—èˆ‰çš„æ–‡ç« ï¼Œæˆ‘è‡ªå·±å‰‡æ˜¯éå¸¸æ¨è–¦ä¸€å®šè¦è®€æ‡‚[Programming Model](https://docs.solana.com/developing/programming-model/overview)ï¼Œå› ç‚ºSolanaçš„Accountæ©Ÿåˆ¶å’ŒEthereuméå¸¸ä¸ä¸€æ¨£ï¼Œæœƒéœ€è¦ä¸€äº›æ™‚é–“ç¿’æ…£ã€‚è€Œé€™ç¯‡è£¡é¢æ‰€è¬›çš„æ±è¥¿åœ¨é–‹ç™¼ä»»ä½•Solanaæ‡‰ç”¨éƒ½æœƒç”¨åˆ°ã€‚

å¦å¤–å¦‚æœæ˜¯æœ‰æƒ³è¦é—œæ³¨NFTé–‹ç™¼çš„äººï¼Œå¯ä»¥é—œæ³¨[Metaplex](https://www.metaplex.com/)

## æº–å‚™

åœ¨é–‹å§‹å‰å¯èƒ½æœƒéœ€è¦é å…ˆå®‰è£ä¸€äº›æ±è¥¿

1. Node.js (æ¨è–¦ä½¿ç”¨nvmæˆ–æ˜¯fnmä¾†å®‰è£)
2. Solana Tool Suite ([é€™è£¡](https://docs.solana.com/cli/install-solana-cli-tools)æœ‰å®‰è£èªªæ˜ï¼Œå¦å¤–å¦‚æœæ˜¯M1çš„è©±ï¼Œå¯ä»¥åƒè€ƒ[é€™è£¡](https://github.com/project-serum/anchor/issues/95#issuecomment-913090162))
3. Anchor ([é€™è£¡](https://project-serum.github.io/anchor/getting-started/installation.html#install-rust)æœ‰å®‰è£æ­¥é©Ÿ)
4. Solana browser wallet (æ¨è–¦ä½¿ç”¨[Phontom](https://phantom.app/))

## é–‹å§‹

### Solana CLI

```sh
solana config get
```

é€™å¯ä»¥çœ‹ä¸€ä¸‹ç•¶å‰solana cliå·¥å…·çš„configè¨­å®šã€‚å¦‚æœä½ é‚„æ²’æœ‰è¨­ç½®keyçš„è©±å¯ä»¥ä¾†[é€™è£¡](https://docs.solana.com/wallet-guide/paper-wallet#seed-phrase-generation)

å¦‚æœæƒ³è¦æ›¿æ›é€£æ¥çš„ç¶²è·¯çš„è©±å¯ä»¥ä½¿ç”¨

```sh
# æ›åˆ° localhost
solana config set --url localhost

# æ›åˆ° devnet
solana config set --url devnet

# æˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç°¡å¯«

# æ›åˆ° localhost
solana config set -ul

# æ›åˆ° devnet
solana config set -ud
```

éš¨æ™‚æ³¨æ„è‡ªå·±çš„é€£æ¥ç¶²è·¯å¾ˆé‡è¦ï¼Œé¿å…ç”¨åˆ°å…¶ä»–ç’°å¢ƒé€ æˆå¥‡æ€ªçš„çµæœã€‚

é€™é‚Šæˆ‘å€‘å…ˆåˆ‡åˆ°devnetä¾†æ–¹ä¾¿ä¸‹é¢å…©å€‹æŒ‡ä»¤çš„æ“ä½œã€‚

ç•¶å‰çš„åœ°å€

```sh
solana address
```

å¸³æˆ¶è©³ç´°çš„è³‡è¨Š

```sh
solana account <ä¸Šé¢çš„åœ°å€>
```

å†ä¾†æˆ‘å€‘åˆ‡æ›åˆ°localhostä¾†é€²è¡Œè¨­ç½®

```sh
# åˆ‡æ›å›localnet
solana config set -ul

# åŸ·è¡Œæœ¬åœ°ç¯€é»
# å¦‚æœæ˜¯Windowsç”¨æˆ¶ï¼Œç›®å‰é‚„ä¸æ”¯æ´é€™å€‹æŒ‡ä»¤
solana-test-validator
```

ç•¶æœ¬åœ°ç¯€é»è·‘èµ·ä¾†çš„æ™‚å€™æˆ‘å€‘å¯ä»¥æ‹¿ä¸€äº›SOLçš„airdrop

```sh
solana aridrop 100
```

SOLé‡‘é¡

```sh
solana balance

# or

solana balance <åœ°å€>
```

å¦‚æœä¸€åˆ‡éƒ½é€²è¡Œå¾—å¾ˆé †åˆ©çš„è©±ï¼Œä½ ç›®å‰æ‡‰è©²æœƒæœ‰100SOLğŸ¤‘ (çš„æ¸¬è©¦ä»£å¹£ğŸ¥²)

## Anchor

æˆ‘å€‘å¯ä»¥ç”¨ä¸‹é¢æŒ‡ä»¤ä¾†ä½¿ç”¨Anchorå•Ÿå‹•ä¸€å€‹æ–°å°ˆæ¡ˆ

```sh
anchor init mysolanaapp

cd mysolanaapp
```

åœ¨é€™å€‹å°ˆæ¡ˆè£¡é¢æ‡‰è©²æœƒæ˜¯é•·å¾—åƒé€™æ¨£çš„çµæ§‹

```sh
.
â”œâ”€â”€ Anchor.toml # anchorçš„è¨­å®šæª”
â”œâ”€â”€ Cargo.toml # cargoçš„è¨­å®šæª”
â”œâ”€â”€ app # æˆ‘å€‘çš„å‰ç«¯codeæœƒåœ¨é€™é‚Š
â”œâ”€â”€ migrations # å¯ä»¥è¨­ç½®deploy script
â”œâ”€â”€ programs # Solana Program æœƒåœ¨é€™è£¡
â””â”€â”€ tests # å¯«æ¸¬è©¦çš„åœ°æ–¹
```

æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ä»–å…§å»ºå¹«æˆ‘å€‘ç”¢å¥½çš„programã€‚

Anchorä½¿ç”¨äº†[eDSL](https://en.wikipedia.org/wiki/Domain-specific_language#:~:text=embedded%20domain%2Dspecific%20language%20(eDSL,methods%2C%20macros%20etc.))ï¼Œä»–ç°¡åŒ–äº†å¾ˆå¤šè¤‡é›œçš„åº•å±¤æ“ä½œï¼Œ
è®“codeè®Šçš„æ›´å®¹æ˜“è®€ã€‚

*programs/mysolanaapp/src/lib.rs*
```rust
use anchor_lang::prelude::*;

declare_id!("Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS");

#[program]
pub mod mysolanaapp {
    use super::*;
    // é€™å€‹æ˜¯ä½ programå®šç¾©çš„æ“ä½œ
    // ç›®å‰åªæœ‰ initialize å¯ä»¥æä¾›çµ¦ä½¿ç”¨è€…å‘¼å«
    pub fn initialize(ctx: Context<Initialize>) -> ProgramResult {
        Ok(())
    }
}
// é€™å€‹æ˜¯è¦å‘¼å«çš„åƒæ•¸è¨­ç½®ï¼Œé€™é‚Šæˆ‘å€‘åªæœ‰initializeçš„functionæœ‰ç”¨åˆ°å®ƒ
#[derive(Accounts)]
pub struct Initialize {}
```

é€™æ‡‰è©²æ˜¯anchorè£¡é¢æœ€åŸºæœ¬çš„programï¼Œé€™å€‹programç›®å‰åªæœ‰æä¾›`initialize`çš„æ“ä½œï¼Œä¸¦æ²’æœ‰ä»»ä½•dataçš„æ›´æ–°ã€‚

`Initialize`çš„structå®šç¾©contextï¼Œæˆ‘å€‘æ™šé»æœƒåœ¨é€™é‚Šå¤šä»‹ç´¹ä¸€äº›ã€‚

è¦ç·¨è­¯é€™å€‹programï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨

```sh
anchor build
```

ç•¶ä½ ç·¨è­¯å®Œæˆå¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹æ–°çš„è³‡æ–™å¤¾ `target`ã€‚å…¶ä¸­æœ‰ä¸€å€‹å¾ˆé‡è¦çš„æª”æ¡ˆæœƒåœ¨
*target/idl/mysolanaapp.json*ã€‚é€™å€‹æ˜¯[IDL](https://en.wikipedia.org/wiki/Interface_description_language)ã€‚

å¯ä»¥æŠŠIDLçœ‹ä½œæ˜¯Solanaçš„[ABI](https://docs.soliditylang.org/en/v0.5.3/abi-spec.html)ï¼Œå°±æ˜¯ä¸€å€‹å®šç¾©queryä»‹é¢çš„ä¸€å€‹æè¿°æª”æ¡ˆã€‚

å¦å¤–æˆ‘å€‘é‚„å¯ä»¥æ¸¬è©¦æˆ‘å€‘çš„Programã€‚

*tests/mysolanaapp.js*
```js
const anchor = require('@project-serum/anchor');

describe('mysolanaapp', () => {

  // Configure the client to use the local cluster.
  anchor.setProvider(anchor.Provider.env());

  it('Is initialized!', async () => {
    // Add your test here.
    const program = anchor.workspace.Mysolanaapp;
    const tx = await program.rpc.initialize();
    console.log("Your transaction signature", tx);
  });
});
```

é€™é‚Šæœ‰å¹¾å€‹æ±è¥¿éœ€è¦ç‰¹åˆ¥ä»‹ç´¹ä¸€ä¸‹ã€‚

### Provider

é€™å€‹æ˜¯å°solanaé€£ç·šçš„ä¸€å€‹æŠ½è±¡ï¼Œæ˜¯ç”±connection, walletå’Œpreflight commitmentçµ„æˆã€‚

åœ¨æ¸¬è©¦è£¡é¢anchoræœƒç”¨`anchor.Provider.env`ä¾†è¨­ç½®providerï¼Œä¸éå¦‚æœæˆ‘å€‘ç¾åœ¨æ˜¯è¦å¯«client appçš„è©±ï¼Œæœƒéœ€è¦æ”¹ç”¨userçš„solanaéŒ¢åŒ…ä¾†è¨­ç½®ã€‚

### Program

é€™æ˜¯å°`Provider`å’Œ`idl`ä»¥åŠ`programID`çš„æŠ½è±¡ã€‚ä¸¦ä¸”å®ƒå…è¨±ä½ å‘¼å«`RPC`æ–¹æ³•ã€‚

è·Ÿproviderä¸€æ¨£ï¼Œæˆ‘å€‘åœ¨client appçš„è¨­ç½®ä¹Ÿéœ€è¦æ³¨æ„ã€‚

ç•¶æˆ‘å€‘æº–å‚™å¥½é€™å…©å€‹æ±è¥¿å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹å’Œprogramäº¤äº’ã€‚å› ç‚ºæˆ‘å€‘åœ¨programè£¡é¢æœ‰`initialize`ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨

```js
const tx = await program.rpc.initialize();
```

ä¾†ç›´æ¥èˆ‡programäº’å‹•ï¼Œè€Œä½¿ç”¨è¦å‰‡çš„è©±é€šå¸¸éƒ½æ˜¯`program.rpc.functionName`

æ™šé»çœ‹æ›´å¤šä¾‹å­çš„æ™‚å€™æˆ‘å€‘å¯ä»¥æœ‰æ›´æ·±åˆ»çš„é«”æœƒã€‚ç¾åœ¨æˆ‘å€‘å…ˆä¾†åŸ·è¡Œçœ‹çœ‹é€™å€‹testã€‚

```sh
anchor test
```

æ²’æ„å¤–çš„è©±ä»–æœƒå™´ä¸€å€‹è­¦å‘Šï¼Œè·Ÿä½ èªªä½ çš„ctxæ²’æœ‰ç”¨ï¼Œè¦æ”¹æˆ_ctxï¼Œé€™æ¨£é€™é‚Šçš„åŸºæœ¬æ“ä½œå°±ç®—æ˜¯å®Œæˆäº†ã€‚æˆ‘å€‘æ¥ä¸‹ä¾†è¦ä¾†æ‰“é€ æˆ‘å€‘ç¬¬ä¸€å€‹Hello World
